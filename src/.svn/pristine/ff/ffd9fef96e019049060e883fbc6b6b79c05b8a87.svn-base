define(['jquery','swipper','common','modal',"tpl","alitong_operate","lazyload","jqueryzoom"],function ($,swipper,common,modal,template,alitong_operate,lazyload,jqueryzoom) {
    $(function(){
        $(".detail_pic img").lazyload();
        $(".big_pic").jqueryzoom({xzoom:350,yzoom:350,offset:20});
    });
    //实例化登录弹出框

    var login_modal = new modal ([
        {name:"title",type:"title",content:"用户登录"},
        {name:"username",type: "fullinput",holder:"请输入账号",icon:"&#xe61f;",cheack:"isphone",tip:"请输入注册手机号"},
        {name:"password",type: "fullinput",holder:"请输入密码",icon:"&#xe624;",cheack:"ispassword",tip:"请输入4-20位密码"},
        {name:"verifyCode",type: "fullinput",holder:"请输入验证码",icon:"&#xe622;",sub:'identify',cheack:"issms",tip:"请输入正确格式的验证码"},
        {name:"col融入i",type: "option",sub:"big,login",link1:domain + "/forgetpassword.html",link2:domain + "/register.html",text:'点击登录'}
    ]);


    var	bindclick = function (dom,callback) {
        $('body').on('click', dom, callback);
    };
    var bindchange = function (dom,callback) {
        $("body").on('change', dom,callback);
    };

    var add_selected = function () {
        $(this).siblings().removeClass('selected');
        if (!$(this).hasClass('selected')) {
            $(this).addClass('selected');
        }
            skuselect.match();
    };
    var add_active = function () {
        $(this).siblings().removeClass('selected')
        if ($(this).hasClass('active')) {
            $(this).removeClass('active');
        }else if (!$(this).hasClass('active')) {
            $(this).addClass('active');
        }
    };
    var stoppop = function (dom) {
        $("body").on('click', dom, function(event) {
            event.stopPropagation();
        });
    };

    //sku点击选择
    bindclick(".sku_option .pic,.sku_option .single_option",add_selected);
    bindclick(".share .download",add_active);
    stoppop(".share .download span");
    bindclick(".already_selected .selected_list",add_active);
    stoppop(".already_selected .selected_list .selected_list_detail");

       //生成已选清单对象
    var skuselect = {
        selected: {},
        getpid : function () {
            var pid = "";
            $(".sku_box .selected").each(function(index, el) {
                pid += $(el).data('value');
            });
            return pid;
        },
        creat: function () {
            var rate = $(".able_sell .hands").data('hands');
            var obj = {};
            $(".sku_box .selected").each(function(index, el) {
                obj[$(el).data('name')] = $(el).data('value');
                obj["text"+index] = $(el).find("span").html();
                if($(el).data('stock')){
                    obj.stock = $(el).data('stock');
                }
            });
            obj.num = $(".able_sell .num").val();
            obj.pair = obj.num*rate;
            return obj;
        },
        pushin: function () {
            var pid = skuselect.getpid();
            var single = skuselect.creat();
            skuselect.selected[pid] = single;
            console.log(skuselect.selected);
            skuselect.getlist();
        },
        del: function (pid) {
            delete skuselect.selected[pid];
            console.log(skuselect.selected);
            skuselect.getlist();
        },
        match: function () {
            var pid = skuselect.getpid();
            console.log(skuselect.selected[pid]);
            if(skuselect.selected[pid]){
                var num = skuselect.selected[pid].num;
                $(num_set.num).val(num);
            }else {
                $(num_set.num).val(0);
            }
            console.log(skuselect.selected);
        },
        getlist: function () {
            var data1 = {
                rate:$(".able_sell .hands").data('hands'),
                data2:[]
            };
            for(var key in skuselect.selected) {
                data1.data2.push(skuselect.selected[key]);
            }
            var _html = template("detail/detail_list",data1);
            $(".selected_list_detail").html(_html);
            $(".total_price span").eq(0).html(skuselect.num_count()+"<b>双</b>");
            $(".total_price span").eq(1).html((skuselect.price_count()/1).toFixed(2)+"<b>元</b>");
        },
        getresult: function () {
            var data1 = {
                data2:[]
            };
            for(var key in skuselect.selected) {
                data1.data2.push(skuselect.selected[key]);
            }
            return data1.data2;
        },
        num_count: function () {
            var list = [];
            var rate = $(".able_sell .hands").data('hands');
            var total_num = 0;
            console.log(skuselect.selected)
            for(var key in skuselect.selected) {
                list.push(skuselect.selected[key]);
            }
            console.log(list);
            $(list).each(function(index, el) {
                total_num += el.num*rate;
            });
            console.log("这是num_count里的log",total_num);
            return total_num;
        },
        price_count: function() {
            var type = $(".databox").data("type");
            var num = skuselect.num_count()
            var total_price = 0;
            //假如是阶梯价
            if(type == "stage"){
                var p1 = $(".databox").data('price1');
                var p2 = $(".databox").data('price2');
                var p3 = $(".databox").data('price3');
                var s1 = $(".databox").data('stage1');
                var s2 = $(".databox").data('stage2');
                var s3 = $(".databox").data('stage3');
                if(num>s1&&s2>=num) {
                    total_price = num*p1;
                }
                if(num>s2&&s3>=num) {
                    total_price = num*p2;
                }
                if(num>s3) {
                    total_price = num*p3;
                }
                return total_price;
            }

            if(type == "normal") {
                var p1 = $(".product_special .price .td").not(".hide").find("b").html();
                total_price = p1*num;
                return total_price;
            }
            if(type == "allbox") {
                var p1 = $(".databox").data('price1');
                var p2 = $(".databox").data('price2');
                var s1 = $(".databox").data('boxnum');
                if(num<s1||num==s1){
                    total_price = p1*num;
                    return total_price;
                }
                if(num > s1){
                    total_price = s1*p1+(num-s1)*p2
                    return total_price;
                }
            }
        }
    };
    //数量选择
    var num_set =  {
        reduce: ".set_num .reduce",
        num: '.set_num .num',
        add: ".set_num .add",
        clean: ".set_num .clean",
        add_func: function () {
            var pid = skuselect.getpid();
            var rate = $(".able_sell .hands").data('hands');
            var temp = $(num_set.num).val();
            temp++;
            $(num_set.num).val(temp);
            if(skuselect.selected[pid]){
                var stock = skuselect.selected[pid].stock;
                if (temp>(stock/rate)){
                    $(num_set.num).val(stock/rate);
                }
            }
            skuselect.pushin();
        },
        reduce_func: function () {
            if ($(num_set.num).val()>0) {
                var temp = $(num_set.num).val();
                temp--;
                $(num_set.num).val(temp);
            }
            skuselect.pushin();
            if ($(num_set.num).val() == "0" ) {
                skuselect.del(skuselect.getpid());
            }

        },
        num_check: function () {
            var temp = $(num_set.num).val();
            var pid = skuselect.getpid();
            console.log(skuselect.selected)
            var stock = skuselect.selected[pid].stock;
            var rate = $(".able_sell .hands").data('hands');
            if (temp<0) {
                $(num_set.num).val(0);
            }
            if (temp>(stock/rate)){
                $(num_set.num).val(stock/rate);
            }
            if ($(num_set.num).val() == "0" ) {
                skuselect.del(skuselect.getpid());
            }else {
                skuselect.pushin();
            }
        },
        clean_func: function () {
            skuselect.selected = {};
            var rate = $(".able_sell .hands").data('hands');
            var pids = skuselect.getpid();
            console.log(rate,pids,"这是rate和pid")
            $(".sku_box .pic").each(function(index, el) {
                var obj = {},pid = "";
                obj[$(el).data('name')] = $(el).data('value');
                obj["text0"] = $(el).find("span").html();
                obj["text1"] = "裸袜";
                obj.stock = $(el).data('stock')
                pid = $(el).data("value")+"0";
                obj.num = (obj.stock)/rate;
                console.log(obj)
                skuselect.selected[pid] = obj;
            });

            console.log(skuselect.selected[pids])
            var num_toset = skuselect.selected[pids].num
            console.log(num_toset)
            $(num_set.num).val(num_toset);
            skuselect.getlist();
        },
        get_num: function () {
            return $(this.num).val();
        },
        init: function () {
            bindclick(this.add,this.add_func);
            bindclick(this.reduce,this.reduce_func);
            bindchange(this.num,this.num_check);
            bindclick(this.clean,this.clean_func);
        }
    };
    //左侧图片
    var left_pic = {
        big_pic: ".show_pic .big_pic",
        smallpic_pics: ".small_pics .pics ul li",
        smallpic_ul: ".small_pics .pics ul",
        left: ".small_pics .turn_left",
        right: ".small_pics .turn_right",
        index: 0,
        view_mid: 2,
        move_length: 65,
        position: 0,
        addindex: function () {
            left_pic.index = ++left_pic.index;
            left_pic.indexcheack();

            left_pic.showchange();
            left_pic.move();
        },
        reduceindex: function () {
            left_pic.index = --left_pic.index;
            left_pic.indexcheack();

            left_pic.showchange();
            left_pic.move();
        },
        setindex : function () {
            left_pic.index = $(this).index();
            left_pic.showchange();
        },
        indexcheack: function () {
            if(left_pic.index < 0){
                left_pic.index = 0;
            }
            if(left_pic.index > $(left_pic.smallpic_pics).length-1){
                left_pic.index = $(left_pic.smallpic_pics).length-1;
            }
        },
        showchange: function () {
            //添加激活类名
            $(left_pic.smallpic_pics).eq(left_pic.index).addClass('active').siblings().removeClass('active');
            var src = $(left_pic.smallpic_pics).eq(left_pic.index).find('img').attr('src');
            $(left_pic.big_pic).find('img').attr('src', src);
        },
        move: function () {
            if(left_pic.index > left_pic.view_mid+2) {
                left_pic.position = left_pic.position - left_pic.move_length;
                left_pic.view_mid++;
            }else if (left_pic.index < left_pic.view_mid-2) {
                left_pic.position = left_pic.position + left_pic.move_length;
                left_pic.view_mid--;
            }
            $(left_pic.smallpic_ul).css('left', left_pic.position+"px");
        },
        init: function () {
            bindclick(this.right,this.addindex);
            bindclick(this.left,this.reduceindex);
            bindclick(this.smallpic_pics,this.setindex);
        }
    };
    //右侧
    var hot_sell = {
        group: ".content_r .content_r_product .group",
        left: ".content_r .content_right_controller .goleft",
        right: ".content_r .content_right_controller .goright",
        ctl_li: ".content_r .content_right_controller ul li",
        index: 0,
        addindex: function () {
            hot_sell.index = ++hot_sell.index;
            hot_sell.indexcheack();
            hot_sell.showchange();
        },
        reduce: function () {
            hot_sell.index = --hot_sell.index;
            hot_sell.indexcheack();
            hot_sell.showchange();
        },
        indexcheack : function () {
            if(hot_sell.index < 0){
                hot_sell.index = $(hot_sell.ctl_li).length-1;
            }
            if(hot_sell.index > $(hot_sell.ctl_li).length-1){
                hot_sell.index = 0;
            }
        },
        setindex : function () {
            hot_sell.index = $(this).index();
            hot_sell.showchange();
        },
        showchange : function () {
            $(hot_sell.group).eq(hot_sell.index).addClass('showtop').siblings().removeClass('showtop');
            $(hot_sell.ctl_li).eq(hot_sell.index).addClass('active').siblings().removeClass('active');
        },
        init : function () {
            bindclick(hot_sell.ctl_li,hot_sell.setindex);
            bindclick(hot_sell.left,hot_sell.reduce);
            bindclick(hot_sell.right,hot_sell.addindex);
        }
    };
    //二次加工选择
    var process_second = {
        body: '.modal_cover_process',
        close: '.modal_cover_process .close',
        single: '.modal_cover_process .single',
        single_num: '.modal_cover_process .single .single_num',
        show_num: '.number_chosed span',
        type:'请选择',
        close_modal: function () {
            $(".modal_cover_process").removeClass('show')
        },
        show_modal: function() {
            $(".modal_cover_process").addClass('show')
        },
        select_func : function () {
            if($(this).hasClass('selected')){
               
            }else if (!$(this).hasClass('selected')) {
                $(this).addClass('selected').siblings('.single').removeClass('selected');
                process_second.type = $(this).find('.single_num').html();
                console.log(process_second.type)
                process_second.set_type();
            }
        },
        set_type: function () {
            $(process_second.show_num).html(process_second.type);
        },
        init: function () {
            $(process_second.show_num).html(process_second.type);
            bindclick('.single_option.seconedtime',process_second.show_modal);
            bindclick(process_second.close,process_second.close_modal);
            bindclick(process_second.single,process_second.select_func);
        }
    };
    process_second.init();
    left_pic.init();
    num_set.init();
    hot_sell.init();
    //渲染热卖推荐和商品推荐
    cataTopAjax();
    bindSeconed();

    var productId = $("#productId").val();

    //点击商品sku图片,显示对应库存,价格
    $(".pic").on('click',function (event) {
        //当前价格类型
        var pricestate = $("#pricestate").val();
        //当前点击sku的索引
        var index1 = $(this).index();
        if (pricestate == 1){
        //获取所有价格的数组
        $(".price").children('div.td').each(function (index,el) {
            if (index == index1)
                $(el).addClass("show").removeClass("hide");
            else
                $(el).addClass("hide").removeClass("show");
        });
        }
        $(".sku_row_stock").find('div.able_sell').each(function(index,el){
            if (index == index1)
                $(el).addClass("show").removeClass("hide");
            else
                $(el).addClass("hide").removeClass("show");
        });
        //当前对象下面的图片
        var img = $(this).children('img').attr("src");
        //更改显示图片
        $('.big_pic > img').attr("src",img);
    });

    //点击收藏商品
    $(".collectProduct").on('click',function (event) {
        if (!isUserLogin()){
            //弹出登录框
            login_modal.showmodal();

            // console.log( $("div.fullinput:last span img"));
            // console.log($(".modal_cotainer .option"));
            $("div.fullinput:last span img").attr("src",domain+"/verify.html");
            return;
        }

        $.ajax({
            type: 'GET',
            dataType: 'json',
            async: false,
            data : {productId :productId},
            url: domain + '/member/docollectproduct.html',
            success: function (data) {
                if(data.success){
                    $(".collectProduct").html("<i class='iconfont shoucang'>&#xe60f;</i><b>已收藏</b>")
                }else{
                    alert(data.message);
                }
            }
        });
    });

    //

    //二次加工点击确定
    $(".modal_cover_process .sure").on('click',function () {
        //获取选择的加工方式id 价钱
      var pkaid =  $(".modal_cover_process .selected").data("pkaid");
      var pkaprice =  $(".modal_cover_process .selected").data("pkaprice");

      //渲染到二次加工按钮
        $(".seconedtime").data("value",pkaid);
      //渲染到二次加工价钱
        $(".second_process").find("b").html(pkaprice);
        //关闭弹出层
        $(".modal_cover_process").removeClass("show");
    });

    //点击立即订购
	$(".buy_now").on('click',function () {
        if (!isUserLogin()) {
            //弹出登录框
            login_modal.showmodal();
            $("div.fullinput:last span img").attr("src", domain + "/verify.html");
            return;
        }
        if(skuselect.getresult().length > 1) {
            for (var int = 0; int < skuselect.getresult().length; int++) {
                var ppid = skuselect.getresult()[int].productPackageId ? skuselect.getresult()[int].productPackageId : '';
                var pgid = skuselect.getresult()[int].productGoodId ? skuselect.getresult()[int].productGoodId : '';
                var num = skuselect.getresult()[int].num ? skuselect.getresult()[int].num : '';
                console.log("ppid=" + ppid, "pgid=" + pgid, "num=" + num, "======================");

                if (!ppid) {
                    $.ajax({
                        type: "POST",
                        dataType: "json",
                        url: domain + "/cart/addtocart.html",
                        data: {
                            productId: productId,
                            productGoodId: parseInt(pgid),
                            number: parseInt(num),
                        },
                        success: function (data) {
                            if (data.success) {
                                var succ = new modal([
                                    {name: "title", type: "title", content: "提示"},
                                    {name: "xx23h", type: "note", content: "订购成功"},
                                    {
                                        name: "col融入i",
                                        type: "option",
                                        sub: "sure",
                                        link1: '22222',
                                        link2: '23231',
                                        text: '确定'
                                    }
                                ]);
                               /* succ.showmodal();
                                $(".sure").on('click', function () {
                                    succ.hidemodal();
                                    //跳转结算页面
                                    window.location.href = domain + "/cart/detail.html";
                                });*/
                                window.location.href = domain + "/cart/detail.html";
                            } else {
                                var errorMess = new modal([
                                    {name: "title", type: "title", content: "异常提示"},
                                    {name: "xx23h", type: "note", content: data.message},
                                    {
                                        name: "col融入i",
                                        type: "option",
                                        sub: "sure",
                                        link1: '22222',
                                        link2: '23231',
                                        text: '确定'
                                    }
                                ]);
                                /*errorMess.showmodal();
                                $(".sure").on('click', function () {
                                    errorMess.hidemodal();
                                    //跳转结算页面
                                    window.location.href = domain + "/cart/detail.html";
                                });*/
                                window.location.href = domain + "/cart/detail.html";
                            }
                        },
                        error: function () {
                            var errorMess = new modal([
                                {name: "title", type: "title", content: "异常提示"},
                                {name: "xx23h", type: "note", content: "数据加载失败"},
                                {
                                    name: "col融入i",
                                    type: "option",
                                    sub: "sure",
                                    link1: '22222',
                                    link2: '23231',
                                    text: '确定'
                                }
                            ]);
                            errorMess.showmodal();
                            $(".sure").on('click', function () {
                                errorMess.hidemodal();
                            });
                        }
                    });
                } else {
                    $.ajax({
                        type: "POST",
                        dataType: "json",
                        url: domain + "/cart/addtocart.html",
                        data: {
                            productId: productId,
                            productGoodId: parseInt(pgid),
                            number: parseInt(num),
                            productPackageId: parseInt(ppid),
                            dabiaowaFlag: 0,
                            isSelfLabel: 0
                        },
                        success: function (data) {
                            if (data.success) {
                                var succ = new modal([
                                    {name: "title", type: "title", content: "提示"},
                                    {name: "xx23h", type: "note", content: "订购成功"},
                                    {
                                        name: "col融入i",
                                        type: "option",
                                        sub: "sure",
                                        link1: '22222',
                                        link2: '23231',
                                        text: '确定'
                                    }
                                ]);
                                /*succ.showmodal();
                                $(".sure").on('click', function () {
                                    succ.hidemodal();
                                    //跳转结算页面
                                    window.location.href = domain + "/cart/detail.html";
                                });*/
                                window.location.href = domain + "/cart/detail.html";
                            } else {
                                var errorMess = new modal([
                                    {name: "title", type: "title", content: "异常提示"},
                                    {name: "xx23h", type: "note", content: data.message},
                                    {
                                        name: "col融入i",
                                        type: "option",
                                        sub: "sure",
                                        link1: '22222',
                                        link2: '23231',
                                        text: '确定'
                                    }
                                ]);
                                errorMess.showmodal();
                                $(".sure").on('click', function () {
                                    errorMess.hidemodal();
                                    //跳转结算页面
                                    window.location.href = domain + "/cart/detail.html";
                                });
                            }
                        },
                        error: function () {
                            var errorMess = new modal([
                                {name: "title", type: "title", content: "异常提示"},
                                {name: "xx23h", type: "note", content: "数据加载失败"},
                                {
                                    name: "col融入i",
                                    type: "option",
                                    sub: "sure",
                                    link1: '22222',
                                    link2: '23231',
                                    text: '确定'
                                }
                            ]);
                            errorMess.showmodal();
                            $(".sure").on('click', function () {
                                errorMess.hidemodal();
                            });
                        }
                    });
                }

            }
        }else{
            var errorMess = new modal([
                {name: "title", type: "title", content: "提示"},
                {name: "xx23h", type: "note", content: "请选择商品"},
                {
                    name: "col融入i",
                    type: "option",
                    sub: "sure",
                    link1: '22222',
                    link2: '23231',
                    text: '确定'
                }
            ]);
            errorMess.showmodal();
            $(".sure").on('click', function () {
                errorMess.hidemodal();
            });
        }

    })

    //点击加入进货单
    $(".add_inpaper").on('click',function () {
        if (!isUserLogin()){
            //弹出登录框
            login_modal.showmodal();
            $("div.fullinput:last span img").attr("src",domain+"/verify.html");
            return;
        }
        if(skuselect.getresult().length > 1) {
            for (var int = 0; int < skuselect.getresult().length; int++) {
                var ppid = skuselect.getresult()[int].productPackageId ? skuselect.getresult()[int].productPackageId : '';
                var pgid = skuselect.getresult()[int].productGoodId ? skuselect.getresult()[int].productGoodId : '';
                var num = skuselect.getresult()[int].num ? skuselect.getresult()[int].num : '';
                console.log("ppid=" + ppid, "pgid=" + pgid, "num=" + num, "======================");

                if (!ppid) {
                    $.ajax({
                        type: "POST",
                        dataType: "json",
                        url: domain + "/cart/addtocart.html",
                        data: {
                            productId: productId,
                            productGoodId: parseInt(pgid),
                            number: parseInt(num),
                        },
                        success: function (data) {
                            if (data.success) {
                                var succ = new modal([
                                    {name: "title", type: "title", content: "提示"},
                                    {name: "xx23h", type: "note", content: "添加成功"},
                                    {
                                        name: "col融入i",
                                        type: "option",
                                        sub: "sure",
                                        link1: '22222',
                                        link2: '23231',
                                        text: '确定'
                                    }
                                ]);
                               /* succ.showmodal();
                                $(".sure").on('click', function () {
                                    succ.hidemodal();
                                    //跳转结算页面
                                    window.location.reload(true);
                                });*/
                                window.location.reload(true);
                            } else {
                                var errorMess = new modal([
                                    {name: "title", type: "title", content: "异常提示"},
                                    {name: "xx23h", type: "note", content: data.message},
                                    {
                                        name: "col融入i",
                                        type: "option",
                                        sub: "sure",
                                        link1: '22222',
                                        link2: '23231',
                                        text: '确定'
                                    }
                                ]);
                                errorMess.showmodal();
                                $(".sure").on('click', function () {
                                    errorMess.hidemodal();
                                    //跳转结算页面
                                    window.location.href = domain + "/cart/detail.html";
                                });

                            }
                        },
                        error: function () {
                            var errorMess = new modal([
                                {name: "title", type: "title", content: "异常提示"},
                                {name: "xx23h", type: "note", content: "数据加载失败"},
                                {
                                    name: "col融入i",
                                    type: "option",
                                    sub: "sure",
                                    link1: '22222',
                                    link2: '23231',
                                    text: '确定'
                                }
                            ]);
                            errorMess.showmodal();
                            $(".sure").on('click', function () {
                                errorMess.hidemodal();
                            });
                        }
                    });
                } else {
                    $.ajax({
                        type: "POST",
                        dataType: "json",
                        url: domain + "/cart/addtocart.html",
                        data: {
                            productId: productId,
                            productGoodId: parseInt(pgid),
                            number: parseInt(num),
                            productPackageId: parseInt(ppid),
                            dabiaowaFlag: 0,
                            isSelfLabel: 0
                        },
                        success: function (data) {
                            if (data.success) {
                                var succ = new modal([
                                    {name: "title", type: "title", content: "提示"},
                                    {name: "xx23h", type: "note", content: "添加成功"},
                                    {
                                        name: "col融入i",
                                        type: "option",
                                        sub: "sure",
                                        link1: '22222',
                                        link2: '23231',
                                        text: '确定'
                                    }
                                ]);
                                /*succ.showmodal();
                                $(".sure").on('click', function () {
                                    succ.hidemodal();
                                    //跳转结算页面
                                    window.location.reload(true);
                                });*/
                                window.location.reload(true);
                            } else {
                                var errorMess = new modal([
                                    {name: "title", type: "title", content: "异常提示"},
                                    {name: "xx23h", type: "note", content: data.message},
                                    {
                                        name: "col融入i",
                                        type: "option",
                                        sub: "sure",
                                        link1: '22222',
                                        link2: '23231',
                                        text: '确定'
                                    }
                                ]);
                                errorMess.showmodal();
                                $(".sure").on('click', function () {
                                    errorMess.hidemodal();
                                    //跳转结算页面
                                    window.location.href = domain + "/cart/detail.html";
                                });

                            }
                        },
                        error: function () {
                            var errorMess = new modal([
                                {name: "title", type: "title", content: "异常提示"},
                                {name: "xx23h", type: "note", content: "数据加载失败"},
                                {
                                    name: "col融入i",
                                    type: "option",
                                    sub: "sure",
                                    link1: '22222',
                                    link2: '23231',
                                    text: '确定'
                                }
                            ]);
                            errorMess.showmodal();
                            $(".sure").on('click', function () {
                                errorMess.hidemodal();
                            });
                        }
                    });
                }

            }
        }else {
            var errorMess = new modal([
                {name: "title", type: "title", content: "提示"},
                {name: "xx23h", type: "note", content: "请选择商品"},
                {
                    name: "col融入i",
                    type: "option",
                    sub: "sure",
                    link1: '22222',
                    link2: '23231',
                    text: '确定'
                }
            ]);
            errorMess.showmodal();
            $(".sure").on('click', function () {
                errorMess.hidemodal();
            });
        }
    })

    //点击验证码,更换验证码
    $("div.fullinput:last span").on('click',function (event) {
        $("div.fullinput:last span img").attr("src",domain+"/verify.html?d"+new Date().getTime());
    });

    //登录弹出框点击登录按钮

    $(".modal_cotainer .option .big").on('click',function (event) {
        if(login_modal.cansend()){
        //console.log( $("div.fullinput:first").find("input").val());
        $(".big").attr("disabled","disabled");
        //console.log(login_modal.getresult());
        var params = "";

        // name=1111&password=111111&verifyCode=5174
        params +="name=" + login_modal.getresult().username;
        params +="&password=" + login_modal.getresult().password;
        params +="&verifyCode=" + login_modal.getresult().verifyCode;
        //用户登录
        $.ajax({
            type: "POST",
            url :domain + "/dodialoglogin.html",
            dataType : "json",
            async : false,
            data  : params,
            success : function (data) {
                if (data.success){
                    login_modal.hidemodal();
                    location.reload();
                }else{
                    var mess = new modal ([
                        {name:"title",type:"title",content:"提示信息"},
                        {name:"xx23h",type:"note",content:data.message},
                        {name:"col融入i",type: "option",sub:"sure",link1:'22222',link2:'23231',text:'确定'}
                    ]);
                    mess.showmodal();
                    //$(".sure").click(mess.hidemodal());
                    $(".sure").on('click',function(){
                        mess.hidemodal();
                    });
                    $("div.fullinput:last span img").attr("src",domain+"/verify.html?d"+new Date().getTime());
                    $(".big").removeAttr("disabled","disabled");
                }

            },
            error : function () {
                var errorMess = new modal ([
                    {name:"title",type:"title",content:"异常提示"},
                    {name:"xx23h",type:"note",content:"异常,请重试!"},
                    {name:"col融入i",type: "option",sub:"sure",link1:'22222',link2:'23231',text:'确定'}
                ]);
                errorMess.showmodal();
                $(".sure").on('click',function(){
                    mess.hidemodal();
                    $(".big").removeAttr("disabled","disabled");
                });
            },
        });
        }

    });

    //进入页面绑定二次加工价格
    function bindSeconed(){
        var pkaid =  $(".modal_cover_process .selected").data("pkaid");
        $(".seconedtime").data("value",pkaid);
    }

    //渲染精品推荐和热卖推荐
    function cataTopAjax(){
        var productId = $("#productId").val();
        ajaxRecommendRight($(".content_r_product"),805,15,productId);
        ajaxRecommendLeft($(".product_content"),804,5,productId);
    }

    function ajaxRecommendLeft(obj,id,size,productId){
        var cateTopHtml = "";
        var m_price ="";
        var url = $("#urlResources").val();
        var imgUrl = $("#imgResources").val();
        $.ajax({
            type:"get",
            url:url + "/recommend.html?q_recommendType=" + id + "&q_size=" + size + "&q_product_id=" + productId,
            dataType: "json",
            cache:false,
            success: function (data) {
                if(data.success){
                    $.each(data.rows,function (i, recommend) {
                        var product = recommend.product;
                        m_price = product.mallPcPrice;
                        cateTopHtml += "<div class='product'><a href='" + url + "/product/" + product.id + ".html'>";
                        cateTopHtml += "<div class='pic'><img src='" + imgUrl + product.masterImg + "'>";
                        cateTopHtml += "<div class='notice'>" + product.name1 + "</div></div></a>";
                        cateTopHtml += "<div class='price'>"+"&yen;" + m_price + "</div></div>";
                    })
                    cateTopHtml += "</div>";
                    obj.append(cateTopHtml);
                }
            }
        });
        return cateTopHtml;
    }
    function ajaxRecommendRight(obj,id,size,productId){
        var cateTopHtml = "";
        var m_price ="";
        var url = $("#urlResources").val();
        var imgUrl = $("#imgResources").val();
        $.ajax({
            type:"get",
            url:url + "/recommend.html?q_recommendType=" + id + "&q_size=" + size + "&q_product_id=" + productId,
            dataType: "json",
            cache:false,
            success: function (data) {
                if(data.success){
                    if (data)
                        for (var i = 0;i < data.rows.length;i++){
                            if(i == 0){
                                cateTopHtml = "<div class='group showtop'>"
                                cateTopHtml += "<a href='" + url + "/product/" + data.rows[i].product.id + ".html'>";
                                cateTopHtml += "<div class='pic'><img src='" + imgUrl + data.rows[i].product.masterImg + "'>";
                                cateTopHtml += "<div class='price'>&yen;" + data.rows[i].product.mallPcPrice +"</div></div></a>";
                                cateTopHtml += "<a href='" + url + "/product/" + data.rows[1].product.id + ".html'>";
                                cateTopHtml += "<div class='pic'><img src='" + imgUrl + data.rows[1].product.masterImg + "'>";
                                cateTopHtml += "<div class='price'>&yen;" + data.rows[1].product.mallPcPrice +"</div></div></a>";
                                cateTopHtml += "<a href='" + url + "/product/" + data.rows[2].product.id + ".html'>";
                                cateTopHtml += "<div class='pic'><img src='" + imgUrl + data.rows[2].product.masterImg + "'>";
                                cateTopHtml += "<div class='price'>&yen;" + data.rows[2].product.mallPcPrice +"</div></div></a></div>";
                            }
                            if (i % 3 == 0 && i != 0 && data.rows.length > 14){
                                cateTopHtml += "<div class='group'>"
                                cateTopHtml += "<a href='" + url + "/product/" + data.rows[i].product.id + ".html'>";
                                cateTopHtml += "<div class='pic'><img src='" + imgUrl + data.rows[i].product.masterImg + "'>";
                                cateTopHtml += "<div class='price'>&yen;" + data.rows[i].product.mallPcPrice +"</div></div></a>";
                                cateTopHtml += "<a href='" + url + "/product/" + data.rows[i + 1].product.id + ".html'>";
                                cateTopHtml += "<div class='pic'><img src='" + imgUrl + data.rows[i + 1].product.masterImg + "'>";
                                cateTopHtml += "<div class='price'>&yen;" + data.rows[i +1].product.mallPcPrice +"</div></div></a>";
                                cateTopHtml += "<a href='" + url + "/product/" + data.rows[i +2].product.id + ".html'>";
                                cateTopHtml += "<div class='pic'><img src='" + imgUrl + data.rows[i +2].product.masterImg + "'>";
                                cateTopHtml += "<div class='price'>&yen;" + data.rows[i +2].product.mallPcPrice +"</div></div></a></div>";
                            }
                        }
                    obj.append(cateTopHtml);
                }
            }
        });
        return cateTopHtml;
    }
})