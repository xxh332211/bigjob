define(["jquery","common","modal"],function ($,common,modal) {
	var select_func = {
		maindom: ".select",
		select_head: ".select .select_head",
		dropdown: ".select .select_dropdown",
		sel_single: ".select .select_dropdown ul li",
		toggle_drop: function (that) {
			$(that).siblings(select_func.dropdown).slideToggle("fast");
		},
		down_drop: function (that) {
			$(that).siblings(select_func.dropdown).slideDown('fast');
		},
		up_drop: function () {
			$(select_func.dropdown).slideUp("fast");
		},
		set_selected: function (that) {
			$(that).addClass('selected').siblings("li").removeClass('selected');
			var selec_text = $(that).find('span').html();
			
			var value = $(that).data("value");
			$(that).parents(".select").find(".select_head").html(selec_text);
			$(that).parents(".select").attr('data-value',value);
		},
		init: function () {
			laydate.render({
			    elem: '.birthday'
			});
			laydate.render({
			    elem: '.start_time'
			});
			laydate.render({
			    elem: '.end_time'
			});
			$("body").on('click', select_func.select_head, function(event) {
				event.stopPropagation();
				var that = this;
				select_func.toggle_drop(that);
			});
			$("body").click(function(event) {
				/* Act on the event */
				select_func.up_drop();
			});
			$("body").on('click', select_func.sel_single, function(event) {
				var that = this;
				event.preventDefault();
				/* Act on the event */
				select_func.set_selected(that);
			});
		}
	};
	var radio_func = {
		radios: ".row label",
		init: function () {
			$(radio_func.radios).click(function(e){
				if(!$(this).hasClass("selected")){
					$(this).addClass("selected").siblings().removeClass("selected");
				}
			});
		}
	}
	var check_box = {
		dom:　".row .cheackbox",
		doms : ".row .cheackbox .box,.row .cheackbox .content",
		init: function () {
			$(check_box.doms).click(function(e){
				if($(check_box.dom).hasClass("checked")){
					$(check_box.dom).removeClass("checked");
				}else {
					$(check_box.dom).addClass("checked");
				}
				
			});
		}
	}

	var redpacket = {
		tags : ".packet_head span",
		bags : ".packet_content>div",
		init : function () {
			$(redpacket.tags).on("click",function(){
				$(this).addClass("selected").siblings().removeClass("selected")
				var index = $(this).index();
				$(redpacket.bags).eq(index).removeClass("hide").siblings().addClass("hide");
				
			});
		}
	}
	function init () {
		redpacket.init();
		check_box.init();
		radio_func.init();
		select_func.init();
	}
	
	init();

	//取消订单窗口
	$("#queryOrders").on('click',function () {
        var orderSn = $("#orderSn").val();
        var orderType = $(".orderType .selected").data("value");
        var logisticType = $(".logisticType .selected").data('value');
        var payType = $(".payType .selected").data("value");
        var coupnType = $("#coupnType").val();
        var createTime_s = $("#createTime_s").val();
        var createTime_e = $("#createTime_e").val();
        var date = orderSn+";"+orderType+";"+logisticType+";"+payType+";"+coupnType+";"+createTime_s+";"+createTime_e;

        window.location.href=domain+"/member/ordersquery.html?q_strs=" +date;
    });
	
	//保存用户基本信息
	$(".preserve").on('click',function () {
        $(".preserve").attr("disabled","disabled");
        var params = "";
        var realName=$("#realName").val();
        params += "realName=" + realName;
        var birthday=$("#birthday").val();
        params += "&birthday=" + birthday;
        var mobile = $("#mobile").val();
        params += "&mobile=" + mobile;
        var quhaoNum=$("input[name='quhaoNum']").val();
        params += "&quhaoNum=" + quhaoNum;
        var teleNum=$("input[name='teleNum']").val();
        params += "&teleNum=" + teleNum;
        var fenjiNum=$("input[name='fenjiNum']").val();
        params += "&fenjiNum=" + fenjiNum;
        var qq = $("input[name='qq']").val();
        params += "&qq=" + qq;
        var wechatNum = $("input[name='wechatNum']").val();
        params += "&wechatNum=" + wechatNum;
        var email = $("input[name='email']").val();
        params += "&email=" + email;
        var certificateNum = $("input[name='certificateNum']").val();
        params += "&certificateNum=" + certificateNum;
        var gender = $(".gender .selected").data("value");
        params += "&gender=" + gender;
        var userCertify = $(".userCertify .selected").data("value");
        params += "&userCertify=" + userCertify;
        var userAddress ="";
            $(".userAddress .selected").each(function (index,el) {
                userAddress +=$(el).data('value');
            });
        params += "&userAddress=" + userAddress;
        var dpAddress = "";
            $(".dpAddress .selected").each(function (index, el) {
                dpAddress +=$(el).data('value');
            });
        params += "&dpAddress=" + dpAddress;
        var userAddinfo = $("#userAddinfo").val();
        params += "&userAddinfo=" + userAddinfo;
        var dpAddinfo = $("#dpAddinfo").val();
        params += "&dpAddinfo=" + dpAddinfo;
        var wdName = $("input[name='wdName']").val();
        params += "&wdName=" + wdName;
        var wdwebAddress = $("input[name='wdwebAddress']").val();
        params += "&wdwebAddress=" + wdwebAddress;
        $.ajax({
            type:"POST",
            url:domain+"/member/saveinfo.html",
            dataType:"json",
            async : false,
            data : params,
            success:function(data){
                if(data.success){
                    alert('保存成功');
                        window.location.href=domain+"/member/info.html"
                }else{
                    alert(data.message);
                    $(".preserve").removeAttr("disabled");
                }
            },
            error:function(){
                alert("异常，请重试！");
                $(".preserve").removeAttr("disabled");
            }
        });
    });


	//修改用户支付密码
    $(".bt_submit").on('click',function(){
            $(".bt_submit").attr("disabled","disabled");
            var params ="";
            var oldPwd=$("input[name='oldPwd']").val();
            var newPwd=$("input[name='newPwd']").val();
            var confirmPwd=$("input[name='confirmPwd']").val();
            if(!oldPwd || !newPwd || !confirmPwd){
                alert("密码不能为空");
                $(".bt_submit").removeAttr("disabled");
                return;
            }
            if(confirmPwd != newPwd){
                alert("密码输入不一致");
                $(".bt_submit").removeAttr("disabled");
                return;
            }
            params += "oldPwd=" + oldPwd;
            params += "&newPwd=" + newPwd;
            params += "&confirmPwd=" + confirmPwd;
            $.ajax({
                type:"POST",
                url:domain+"/member/updatebalancepassword.html",
                dataType:"json",
                async : false,
                data : params,
                success:function(data){
                    if(data.success){
                        alert('密码设置成功');
                        window.location.href=domain+"/member/balance.html"
                    }else{
                        alert(data.message);
                        $(".bt_submit").removeAttr("disabled");
                    }
                },
                error:function(){
                    alert("异常，请重试！");
                    $(".bt_submit").removeAttr("disabled");
                }
            });
    });

    //重置用户支付密码
    $(".reset_submit").on('click',function(){
            $(".bt_submit").attr("disabled","disabled");
            var params = "";
            var newPwd=$("input[name='newPwd']").val();
            var confirmPwd=$("input[name='confirmPwd']").val();
            var mobVerify=$("input[name='mobVerify']").val();
            if(!mobVerify){
                alert("验证码不能为空");
                $(".reset_submit").removeAttr("disabled");
                return;
            }
            if(!newPwd || !confirmPwd){
                alert("密码不能为空");
                $(".reset_submit").removeAttr("disabled");
                return;
            }
            if(confirmPwd != newPwd){
                alert("密码输入不一致");
                $(".reset_submit").removeAttr("disabled");
                return;
            }
            params += "mobVerify=" + mobVerify;
            params += "&newPwd=" + newPwd;
            params += "&confirmPwd=" + confirmPwd;
            $.ajax({
                type:"POST",
                url:domain+"/member/resetbalancepassword.html",
                dataType:"json",
                async : false,
                data : params,
                success:function(data){
                    if(data.success){
                        alert('密码重置成功')
                        window.location.href=domain+"/member/balance.html"
                    }else{
                        alert(data.message);
                        $(".reset_submit").removeAttr("disabled");
                    }
                },
                error:function(){
                    alert("异常，请重试！");
                    $(".reset_submit").removeAttr("disabled");
                }
            });

    });

    //新增用户收货地址
    $(".saveConsigneeButton").on('click',function(){
        var provinceId = $('.province .selected').data("value");
        var cityId = $('.city .selected').data("value");
        var areaId = $('.area .selected').data("value");
        var memberName = $("#consignee_name").val();
        var addressInfo = $("#consignee_address").val();
        var mobile = $("#consignee_mobile").val();
        var zipCode = $("#consignee_zipcode").val();

        //获得省市区中文并拼接
        var addall= $('.province .selected span').html() + $('.city .selected span').html()+$('.area .selected span').html();
        var zipCode = $("#consignee_zipcode").val();
        if(!memberName){
            alert("收货人姓名必填");
        }
        if(!provinceId || !cityId || !areaId ){
            alert("请选择详细的所在地区")
        }
        if(!addressInfo){
            alert("详细地址必填");
        }
        if(!mobile){
            alert("手机号码必填");
        }
        if(zipCode == null || zipCode == ''){
            $("#consignee_zipcode").val("000000");
        }

         $(".saveConsigneeButton").attr("disabled","disabled");
         var params = "";
        params += "addAll=" + addall;
        params += "&id=&memberName=" + memberName;
        params += "&provinceId=" + provinceId;
        params += "&cityId=" + cityId;
        params += "&areaId=" + areaId;
        params += "&addressInfo=" + addressInfo;
        params += "&mobile=" + mobile;
        params += "&zipCode=" + zipCode;
         $.ajax({
             type:"POST",
             url:domain+"/member/saveaddress.html",
             dataType:"json",
             data : params,
             success:function(data){
                 if(data.success){
                     window.location.reload();
                 }else{
                     alert(data.message);
                     $("#saveConsigneeButton").removeAttr("disabled");
                 }
             },
             error:function(){
                 alert("异常，请重试！");
                 $("#saveConsigneeButton").removeAttr("disabled");
             }
            });

    });

    //修改用户登录密码
    $(".bt_editPwd").on('click',function(){
        $(".bt_editPwd").attr("disabled","disabled");
        var params ="";
        var oldPwd=$("input[name='oldPwd']").val();
        var newPwd=$("input[name='newPwd']").val();
        var confirmPwd=$("input[name='confirmPwd']").val();
        if(!oldPwd || !newPwd || !confirmPwd){
            alert("密码不能为空");
            $(".bt_editPwd").removeAttr("disabled");
            return;
        }
        if(confirmPwd != newPwd){
            alert("密码输入不一致");
            $(".bt_editPwd").removeAttr("disabled");
            return;
        }
        params += "oldPwd=" + oldPwd;
        params += "&newPwd=" + newPwd;
        params += "&confirmPwd=" + confirmPwd;
            $.ajax({
                type:"POST",
                url:domain+"/member/updatepassword.html",
                dataType:"json",
                async : false,
                data : params,
                success:function(data){
                    if(data.success){
                        alert('密码修改成功')
                            window.location.href=domain+"/member/editpassword.html"
                    }else{
                        alert(data.message);
                        $(".bt_editPwd").removeAttr("disabled");
                    }
                },
                error:function(){
                    alert("异常，请重试！");
                    $(".bt_editPwd").removeAttr("disabled");
                }
            });
    });

    //取消用户商品收藏
    $(".goods-delete").click(function() {
        unfollowProduct($(this));
    });
	//删除用户浏览记录look-delete
    $(".look-delete").click(function() {
        deleteProductId($(this));
    });
});


//取消订单
function cancalOrder(tradeNo){
    if(confirm("确定要取消该订单吗？")){
        $.ajax({
            type : "GET",
            url :  domain+"/member/cancalorder.html",
            data : {tradeNo:tradeNo},
            dataType : "json",
            success : function(data) {
                if(data.success){
                    window.location.reload();
                }else {
                    alert(data.message);
                }
            },
            error : function() {
                alert("数据加载失败！");
            }
        });
    }
}

//删除订单
function deleteOrder(orderId){
    if(confirm("确定要删除该订单吗？")){
        $.ajax({
            type : "GET",
            url :  domain+"/member/deleteorder.html",
            data : {orderId:orderId},
            dataType : "json",
            success : function(data) {
                if(data.success){
                    window.location.reload();
                }else {
                    alert(data.message);
                }
            },
            error : function() {
                alert("数据加载失败！");
            }
        });
    }
}

//确认收货
function goodsReceipt(ordersId){
    $.ajax({
        type : "GET",
        url :  domain+"/member/goodreceive.html",
        data : {ordersId:ordersId},
        dataType : "json",
        success : function(data) {
            if(data.success){
                window.location.reload();
            }else {
                alert(data.message);
            }
        },
        error : function() {
            alert("数据加载失败！");
        }
    });
}

//取消商品收藏
function unfollowProduct(obj){
    if(confirm("是否取消关注")){
        var id = obj.data("id");
        $.ajax({
            type:"GET",
            url:domain+"/member/cancelcollectproduct.html",
            dataType:"json",
            async : false,
            data : {productId:id},
            success:function(data){
                if(data.success){
                    obj.parent().remove();
                }else{
                    alert(data.message);
                }
            },
            error:function(){
                alert("异常，请重试！");
            }
        });
    }
}

//删除浏览记录
function deleteProductId(obj){
    var productId = obj.data("id");
    $.ajax({
        type : "GET",
        url :  domain+"/member/deleteproductlog.html",
        data : {productId:productId},
        dataType : "json",
        success : function(data) {
            if(data.success){
                obj.parent().remove();
            }
        }
    });
}
//设置默认地址
function  defaultAddress(id){
    $.ajax({
        type:"POST",
        url:domain+"/member/setdefaultaddress.html",
        dataType:"json",
        data : {id:id},
        success:function(data){
            if(data.success){
                //重新加载列表数据
                window.location.href= domain+"/member/address.html";
            }else{
                alert(data.message);
            }
        },
        error:function(){
            alert("异常，请重试！");
        }
    });
}
//删除收货地址
function  deleteAddress(id){
    if(confirm("是否确认删除")){
        //删除地址
        $.ajax({
            type:"POST",
            url:domain+"/member/deleteaddress.html",
            dataType:"json",
            async : false,
            data : {id:id},
            success:function(data){
                if(data.success){
                    //重新加载列表数据
                    window.location.href= domain+"/member/address.html";
                }else{
                    alert(data.message);
                }
            },
            error:function(){
                alert("异常，请重试！");
            }
        });
    }
}
